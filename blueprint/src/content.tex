% In this file you should put the actual content of the blueprint.
% It will be used both by the web and the print version.
% It should *not* include the \begin{document}
%
% If you want to split the blueprint content into several files then
% the current file can be a simple sequence of \input. Otherwise It
% can start with a \section or \chapter for instance.

\chapter{Regular Sequences}
\label{section-regular-sequences}

\noindent
In this section we develop some basic properties of regular sequences.

\begin{definition}\cite[\href{https://stacks.math.columbia.edu/tag/00LF}{Definition 00LF}]{stacks-project}
	\label{definition-regular-sequence}
	Let $R$ be a ring. Let $M$ be an $R$-module. A sequence of elements
	$f_1, \ldots, f_r$ of $R$ is called an {\it $M$-regular sequence}
	if the following conditions hold:
	\begin{enumerate}
		\item $f_i$ is a nonzerodivisor on
		$M/(f_1, \ldots, f_{i - 1})M$
		for each $i = 1, \ldots, r$, and
		\item the module $M/(f_1, \ldots, f_r)M$ is not zero.
	\end{enumerate}
	If $I$ is an ideal of $R$ and $f_1, \ldots, f_r \in I$
	then we call $f_1, \ldots, f_r$ an {\it $M$-regular sequence
		in $I$}. If $M = R$, we call $f_1, \ldots, f_r$ simply a
	{\it regular sequence} (in $I$).
\end{definition}

\noindent
Please pay attention to the fact that the definition depends on the order
of the elements $f_1, \ldots, f_r$ (see examples below). Some papers/books
drop the requirement that the module $M/(f_1, \ldots, f_r)M$ is nonzero.
This has the advantage that being a regular sequence is preserved under
localization. However, we will use this definition mainly to define the
depth of a module in case $R$ is local; in that case the $f_i$ are required
to be in the maximal ideal -- a condition which is not preserved under going
from $R$ to a localization $R_{\mathfrak p}$.

\begin{example}\cite[\href{https://stacks.math.columbia.edu/tag/00LG}{Example 00LG}]{stacks-project}
	\label{example-global-regular}
	Let $k$ be a field. In the ring $k[x, y, z]$
	the sequence $x, y(1-x), z(1-x)$ is regular
	but the sequence $y(1-x), z(1-x), x$ is not.
\end{example}

\begin{example}\cite[\href{https://stacks.math.columbia.edu/tag/00LH}{Example 00LH}]{stacks-project}
	\label{example-local-regular}
	Let $k$ be a field. Consider the ring
	$k[x, y, w_0, w_1, w_2, \ldots]/I$
	where $I$ is generated by $yw_i$, $i = 0, 1, 2, \ldots$ and
	$w_i - xw_{i + 1}$, $i = 0, 1, 2, \ldots$.
	The sequence $x, y$ is regular, but $y$ is a zerodivisor.
	Moreover you can localize at the maximal ideal
	$(x, y, w_i)$ and still get an example.
\end{example}

\begin{lemma}\cite[\href{https://stacks.math.columbia.edu/tag/00LJ}{Lemma 00LJ}]{stacks-project}
	\label{lemma-permute-xi}
	Let $R$ be a local Noetherian ring.
	Let $M$ be a finite $R$-module.
	Let $x_1, \ldots, x_c$ be an $M$-regular sequence.
	Then any permutation of the $x_i$ is a regular
	sequence as well.
\end{lemma}

\begin{proof}
	First we do the case $c = 2$.
	Consider $K \subset M$ the kernel of $x_2 : M \to M$.
	For any $z \in K$ we know that $z = x_1 z'$
	for some $z' \in M$ because
	$x_2$ is a nonzerodivisor on $M/x_1M$.
	Because $x_1$ is a nonzerodivisor on $M$ we see that $x_2 z' = 0$
	as well. Hence $x_1 : K \to K$ is surjective.
	Thus $K = 0$ by Nakayama's Lemma.
	Next, consider multiplication by $x_1$ on $M/x_2M$.
	If $z \in M$ maps to an element $\overline{z} \in M/x_2M$
	in the kernel of this map, then $x_1 z = x_2 y$ for some $y \in M$.
	But then since $x_1, x_2$ is a regular sequence we see that
	$y = x_1 y'$ for some $y' \in M$. Hence $x_1 ( z - x_2 y' ) =0$
	and hence $z = x_2 y'$ and hence $\overline{z} = 0$ as desired.
	
	\medskip\noindent
	For the general case, observe that any permutation is
	a composition of transpositions of adjacent indices.
	Hence it suffices to prove that
	$$
	x_1, \ldots, x_{i-2}, x_i, x_{i-1}, x_{i + 1}, \ldots, x_c
	$$
	is an $M$-regular sequence. This follows from the case we
	just did applied to the module $M/(x_1, \ldots, x_{i-2})$
	and the length $2$ regular sequence $x_{i-1}, x_i$.
\end{proof}

\begin{lemma}\cite[\href{https://stacks.math.columbia.edu/tag/00LM}{Lemma 00LM}]{stacks-project}
	\label{lemma-flat-increases-depth}
	\begin{slogan}
		Flat local ring homomorphisms preserve and reflect regular sequences.
	\end{slogan}
	Let $R, S$ be local rings. Let $R \to S$ be a flat local ring homomorphism.
	Let $x_1, \ldots, x_r$ be a sequence in $R$. Let $M$ be an $R$-module.
	The following are equivalent
	\begin{enumerate}
		\item $x_1, \ldots, x_r$ is an $M$-regular sequence in $R$, and
		\item the images of $x_1, \ldots, x_r$ in $S$ form a $M \otimes_R S$-regular
		sequence.
	\end{enumerate}
\end{lemma}

\begin{proof}
	This is so because $R \to S$ is faithfully flat
	by \cite[\href{https://stacks.math.columbia.edu/tag/00HR}{Lemma 00HR}]{stacks-project}.
\end{proof}

\begin{lemma}\cite[\href{https://stacks.math.columbia.edu/tag/061L}{Lemma 061L}]{stacks-project}
	\label{lemma-regular-sequence-in-neighbourhood}
	Let $R$ be a Noetherian ring. Let $M$ be a finite $R$-module.
	Let $\mathfrak p$ be a prime. Let $x_1, \ldots, x_r$ be a sequence
	in $R$ whose image in $R_{\mathfrak p}$ forms an $M_{\mathfrak p}$-regular
	sequence. Then there exists a $g \in R$, $g \not \in \mathfrak p$
	such that the image of $x_1, \ldots, x_r$ in $R_g$ forms
	an $M_g$-regular sequence.
\end{lemma}

\begin{proof}
	Set
	$$
	K_i = \Ker\left(x_i : M/(x_1, \ldots, x_{i - 1})M \to
	M/(x_1, \ldots, x_{i - 1})M\right).
	$$
	This is a finite $R$-module whose localization at $\mathfrak p$ is
	zero by assumption. Hence there exists a $g \in R$, $g \not \in \mathfrak p$
	such that $(K_i)_g = 0$ for all $i = 1, \ldots, r$. This $g$ works.
\end{proof}

\begin{lemma}\cite[\href{https://stacks.math.columbia.edu/tag/065K}{Lemma 065K}]{stacks-project}
	\label{lemma-join-regular-sequences}
	Let $A$ be a ring. Let $I$ be an ideal generated by a regular
	sequence $f_1, \ldots, f_n$ in $A$. Let $g_1, \ldots, g_m \in A$ be
	elements whose images $\overline{g}_1, \ldots, \overline{g}_m$ form a
	regular sequence in $A/I$. Then $f_1, \ldots, f_n, g_1, \ldots, g_m$
	is a regular sequence in $A$.
\end{lemma}

\begin{proof}
	This follows immediately from the definitions.
\end{proof}

\begin{lemma}\cite[\href{https://stacks.math.columbia.edu/tag/0F1T}{Lemma 0F1T}]{stacks-project}
	\label{lemma-regular-sequence-short-exact-sequence}
	Let $R$ be a ring. Let $0 \to M_1 \to M_2 \to M_3 \to 0$
	be a short exact sequence of $R$-modules. Let $f_1, \ldots, f_r \in R$.
	If $f_1, \ldots, f_r$ is $M_1$-regular and $M_3$-regular, then
	$f_1, \ldots, f_r$ is $M_2$-regular.
\end{lemma}

\begin{proof}
	By snake lemma, if $f_1 : M_1 \to M_1$ and
	$f_1 : M_3 \to M_3$ are injective, then so is $f_1 : M_2 \to M_2$
	and we obtain a short exact sequence
	$$
	0 \to M_1/f_1M_1 \to M_2/f_1M_2 \to M_3/f_1M_3 \to 0
	$$
	The lemma follows from this and induction on $r$. Some details omitted.
\end{proof}

\begin{lemma}\cite[\href{https://stacks.math.columbia.edu/tag/07DV}{Lemma 07DV}]{stacks-project}
	\label{lemma-regular-sequence-powers}
	Let $R$ be a ring. Let $M$ be an $R$-module.
	Let $f_1, \ldots, f_r \in R$ and $e_1, \ldots, e_r > 0$ integers.
	Then $f_1, \ldots, f_r$ is an $M$-regular sequence
	if and only if $f_1^{e_1}, \ldots, f_r^{e_r}$
	is an $M$-regular sequence.
\end{lemma}

\begin{proof}
	We will prove this by induction on $r$. If $r = 1$ this follows from the
	following two easy facts: (a) a power of a nonzerodivisor on $M$
	is a nonzerodivisor on $M$ and (b) a divisor of a nonzerodivisor on $M$
	is a nonzerodivisor on $M$.
	If $r > 1$, then by induction applied to $M/f_1M$ we have that
	$f_1, f_2, \ldots, f_r$ is an $M$-regular sequence if and only if
	$f_1, f_2^{e_2}, \ldots, f_r^{e_r}$ is an $M$-regular sequence.
	Thus it suffices to show, given $e > 0$, that $f_1^e, f_2, \ldots, f_r$
	is an $M$-regular sequence if and only if $f_1, \ldots, f_r$
	is an $M$-regular sequence. We will prove this
	by induction on $e$. The case $e = 1$ is trivial. Since $f_1$ is a
	nonzerodivisor under both assumptions (by the case $r = 1$)
	we have a short exact sequence
	$$
	0 \to M/f_1M \xrightarrow{f_1^{e - 1}} M/f_1^eM \to M/f_1^{e - 1}M \to 0
	$$
	Suppose that $f_1, f_2, \ldots, f_r$ is an $M$-regular sequence.
	Then by induction the elements $f_2, \ldots, f_r$ are $M/f_1M$ and
	$M/f_1^{e - 1}M$-regular sequences. By
	Lemma \ref{lemma-regular-sequence-short-exact-sequence}
	$f_2, \ldots, f_r$ is $M/f_1^eM$-regular. Hence $f_1^e, f_2, \ldots, f_r$
	is $M$-regular. Conversely, suppose
	that $f_1^e, f_2, \ldots, f_r$ is an $M$-regular sequence. Then
	$f_2 : M/f_1^eM \to M/f_1^eM$ is injective, hence
	$f_2 : M/f_1M \to M/f_1M$ is injective, hence by induction(!)
	$f_2 : M/f_1^{e - 1}M \to M/f_1^{e - 1}M$ is injective, hence
	$$
	0 \to
	M/(f_1, f_2)M \xrightarrow{f_1^{e - 1}}
	M/(f_1^e, f_2)M \to
	M/(f_1^{e - 1}, f_2)M \to 0
	$$
	is a short exact sequence by snake lemma. This proves the
	converse for $r = 2$. If $r > 2$, then we have
	$f_3 : M/(f_1^e, f_2)M \to M/(f_1^e, f_2)M$ is injective, hence
	$f_3 : M/(f_1, f_2)M \to M/(f_1, f_2)M$ is injective, and so on.
	Some details omitted.
\end{proof}

\begin{lemma}\cite[\href{https://stacks.math.columbia.edu/tag/07DW}{Lemma 07DW}]{stacks-project}
	\label{lemma-regular-sequence-in-polynomial-ring}
	Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$ which do not generate
	the unit ideal. The following are equivalent:
	\begin{enumerate}
		\item any permutation of $f_1, \ldots, f_r$ is a regular sequence,
		\item any subsequence of $f_1, \ldots, f_r$ (in the given order) is
		a regular sequence, and
		\item $f_1x_1, \ldots, f_rx_r$ is a regular sequence in the polynomial
		ring $R[x_1, \ldots, x_r]$.
	\end{enumerate}
\end{lemma}

\begin{proof}
	It is clear that (1) implies (2). We prove (2) implies (1) by induction
	on $r$. The case $r = 1$ is trivial. The case $r = 2$ says that if
	$a, b \in R$ are a regular sequence and $b$ is a nonzerodivisor, then
	$b, a$ is a regular sequence. This is clear because the kernel of
	$a : R/(b) \to R/(b)$ is isomorphic to the kernel of $b : R/(a) \to R/(a)$
	if both $a$ and $b$ are nonzerodivisors. The case $r > 2$. Assume
	(2) holds and say we want to prove $f_{\sigma(1)}, \ldots, f_{\sigma(r)}$
	is a regular sequence for some permutation $\sigma$. We already know
	that $f_{\sigma(1)}, \ldots, f_{\sigma(r - 1)}$ is a regular sequence
	by induction. Hence it suffices to show that $f_s$ where $s = \sigma(r)$
	is a nonzerodivisor modulo $f_1, \ldots, \hat f_s, \ldots, f_r$.
	If $s = r$ we are done. If $s < r$, then note that $f_s$ and $f_r$
	are both nonzerodivisors in the ring
	$R/(f_1, \ldots, \hat f_s, \ldots, f_{r - 1})$
	(by induction hypothesis again). Since we know $f_s, f_r$ is a
	regular sequence in that ring we conclude by the case of sequence of length
	$2$ that $f_r, f_s$ is too.
	
	\medskip\noindent
	Note that $R[x_1, \ldots, x_r]/(f_1x_1, \ldots, f_ix_i)$ as an $R$-module
	is a direct sum of the modules
	$$
	R/I_E \cdot x_1^{e_1} \ldots x_r^{e_r}
	$$
	indexed by multi-indices $E = (e_1, \ldots, e_r)$ where
	$I_E$ is the ideal generated by $f_j$ for $1 \leq j \leq i$
	with $e_j > 0$. Hence $f_{i + 1}x_i$ is a nonzerodivisor on this if
	and only if $f_{i + 1}$ is a nonzerodivisor on $R/I_E$ for all $E$.
	Taking $E$ with all positive entries, we see that $f_{i + 1}$
	is a nonzerodivisor on $R/(f_1, \ldots, f_i)$. Thus (3) implies (2).
	Conversely, if (2) holds, then any subsequence of
	$f_1, \ldots, f_i, f_{i + 1}$ is a regular sequence
	in particular $f_{i + 1}$ is a nonzerodivisor on all $R/I_E$.
	In this way we see that (2) implies (3).
\end{proof}
